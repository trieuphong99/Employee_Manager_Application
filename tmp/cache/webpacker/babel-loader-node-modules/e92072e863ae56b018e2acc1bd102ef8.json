{"ast":null,"code":"function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport axios from \"axios\";\nimport FormData from 'form-data';\nimport { toastError, toastSuccess } from '../../commons/helpers/toastHelpers/';\nimport { hideLoading, showLoading } from './loading';\nimport _ from 'lodash';\nexport var getReport = function getReport(id, setInitialValues) {\n  var url = id !== null ? \"/reports/\".concat(id) : \"/reports/new\";\n  axios.get(url).then(function (res) {\n    var _res$data = res.data,\n        users_list = _res$data.users_list,\n        channels_list = _res$data.channels_list;\n    var _res$data$report_seri = res.data.report_serializer,\n        report_message = _res$data$report_seri.report_message,\n        attachments = _res$data$report_seri.attachments,\n        send_to = _res$data$report_seri.send_to;\n\n    var channels = _.map(channels_list, function (o) {\n      return {\n        value: o.channel_code,\n        label: o.channel_name\n      };\n    });\n\n    var send_to_channels = _.map(send_to, function (o) {\n      return {\n        value: o.channel_code,\n        label: o.channel_name\n      };\n    });\n\n    setInitialValues({\n      report_message: report_message,\n      attachments: attachments,\n      users: users_list,\n      channels: channels,\n      send_to: send_to_channels\n    });\n  })[\"catch\"](function (error) {\n    toastError(error.response.data);\n  });\n};\nexport var postFile = function postFile(id, formData) {\n  formData.append(\"report_id\", id);\n  return function (dispatch) {\n    dispatch(showLoading());\n    axios({\n      url: \"/attachments\",\n      method: 'post',\n      headers: {\n        'Content-Type': 'multipart/form-data'\n      },\n      data: formData\n    }).then(function (res) {\n      toastSuccess(\"Successful!\");\n    })[\"catch\"](function (error) {\n      toastError(error.response.data);\n    })[\"finally\"](function () {\n      formData[\"delete\"]('report_id');\n      formData[\"delete\"]('attachments[]');\n      dispatch(hideLoading());\n    });\n  };\n};\nexport var putFile = function putFile(id, formData) {\n  formData.append(\"report_id\", id);\n  return function (dispatch) {\n    dispatch(showLoading());\n    axios({\n      url: \"/attachments/update\",\n      method: 'post',\n      headers: {\n        'Content-Type': 'multipart/form-data'\n      },\n      data: formData\n    }).then(function (res) {\n      toastSuccess(\"Successful!\");\n    })[\"catch\"](function (error) {\n      toastError(error.response.data);\n    })[\"finally\"](function () {\n      formData[\"delete\"]('report_id');\n      formData[\"delete\"]('delete_ids[]');\n      formData[\"delete\"]('attachments[]');\n      dispatch(hideLoading());\n    });\n  };\n};\nexport var postReport = function postReport(timesheet_id, formData, reload, data) {\n  var body = _objectSpread({\n    timesheet_id: timesheet_id\n  }, data);\n\n  return function (dispatch) {\n    dispatch(showLoading());\n    axios.post(\"/reports\", body).then(function (res) {\n      var id = res.data.id;\n      formData.get('attachments[]') !== null ? dispatch(postFile(id, formData)) : toastSuccess(\"Successful!\");\n    })[\"catch\"](function (error) {\n      toastError(error.response.data);\n    })[\"finally\"](function () {\n      // update report_id in timesheets\n      reload();\n      dispatch(hideLoading());\n    });\n  };\n};\nexport var updateReport = function updateReport(report_id, formData, data) {\n  var body = _objectSpread({}, data);\n\n  return function (dispatch) {\n    dispatch(showLoading());\n    return axios.put(\"/reports/\".concat(report_id), body).then(function (res) {\n      var _res$data2 = res.data,\n          id = _res$data2.id,\n          attachments = _res$data2.attachments;\n      formData.get('attachments[]') !== null || formData.get('delete_ids[]') !== null ? _.isEqual(attachments, []) ? dispatch(postFile(id, formData)) : dispatch(putFile(id, formData)) : toastSuccess(\"Successful!\");\n    })[\"catch\"](function (error) {\n      toastError(error.response.data);\n    })[\"finally\"](function () {\n      dispatch(hideLoading());\n    });\n  };\n};","map":{"version":3,"sources":["/home/phong/rails/imp/app/javascript/staff/actions/report.js"],"names":["axios","FormData","toastError","toastSuccess","hideLoading","showLoading","_","getReport","id","setInitialValues","url","get","then","res","data","users_list","channels_list","report_serializer","report_message","attachments","send_to","channels","map","o","value","channel_code","label","channel_name","send_to_channels","users","error","response","postFile","formData","append","dispatch","method","headers","putFile","postReport","timesheet_id","reload","body","post","updateReport","report_id","put","isEqual"],"mappings":"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","sourcesContent":["import axios from \"axios\";\nimport FormData from 'form-data'\nimport { toastError, toastSuccess } from '../../commons/helpers/toastHelpers/'\nimport { hideLoading, showLoading } from './loading'\nimport _ from 'lodash'\n\nexport const getReport = (id, setInitialValues) => {\n  const url = id !== null ? `/reports/${id}` : `/reports/new`\n  axios.get(url)\n    .then(res => {\n      const { users_list, channels_list } = res.data\n      const { report_message, attachments, send_to } = res.data.report_serializer\n      const channels = _.map(channels_list, o => ({ value: o.channel_code, label: o.channel_name }))\n      const send_to_channels = _.map(send_to, o => ({ value: o.channel_code, label: o.channel_name }))\n      setInitialValues({ report_message, attachments, users: users_list, channels, send_to: send_to_channels })\n    })\n    .catch(function (error) {\n      toastError(error.response.data);\n    })\n}\n\nexport const postFile = (id, formData) => {\n  formData.append(\"report_id\", id)\n  return dispatch => {\n    dispatch(showLoading())\n    axios({\n      url: \"/attachments\",\n      method: 'post',\n      headers: { 'Content-Type': 'multipart/form-data' },\n      data: formData\n    })\n      .then(res => {\n        toastSuccess(\"Successful!\")\n      })\n      .catch(function (error) {\n        toastError(error.response.data);\n      })\n      .finally(function () {\n        formData.delete('report_id')\n        formData.delete('attachments[]')\n        dispatch(hideLoading())\n      });\n  }\n}\n\nexport const putFile = (id, formData) => {\n  formData.append(\"report_id\", id)\n  return dispatch => {\n    dispatch(showLoading())\n    axios({\n      url: \"/attachments/update\",\n      method: 'post',\n      headers: { 'Content-Type': 'multipart/form-data' },\n      data: formData\n    })\n      .then(res => {\n        toastSuccess(\"Successful!\")\n      })\n      .catch(function (error) {\n        toastError(error.response.data);\n      })\n      .finally(function () {\n        formData.delete('report_id')\n        formData.delete('delete_ids[]')\n        formData.delete('attachments[]')\n        dispatch(hideLoading())\n      });\n  }\n}\n\nexport const postReport = (timesheet_id, formData, reload, data) => {\n  const body = {\n    timesheet_id,\n    ...data\n  }\n  return dispatch => {\n    dispatch(showLoading())\n    axios.post(`/reports`, body)\n      .then(res => {\n        const { id } = res.data\n        formData.get('attachments[]') !== null\n          ? dispatch(postFile(id, formData))\n          : toastSuccess(\"Successful!\")\n      })\n      .catch(function (error) {\n        toastError(error.response.data);\n      })\n      .finally(function () {\n        // update report_id in timesheets\n        reload()\n        dispatch(hideLoading())\n      });\n  }\n}\n\nexport const updateReport = (report_id, formData, data) => {\n  const body = {\n    ...data\n  }\n  return dispatch => {\n    dispatch(showLoading())\n    return axios.put(`/reports/${report_id}`, body)\n      .then(res => {\n        const { id, attachments } = res.data\n        formData.get('attachments[]') !== null || formData.get('delete_ids[]') !== null\n          ? _.isEqual(attachments, [])\n            ? dispatch(postFile(id, formData))\n            : dispatch(putFile(id, formData))\n          : toastSuccess(\"Successful!\")\n      })\n      .catch(function (error) {\n        toastError(error.response.data);\n      })\n      .finally(function () {\n        dispatch(hideLoading())\n      });\n  }\n}"]},"metadata":{},"sourceType":"module"}