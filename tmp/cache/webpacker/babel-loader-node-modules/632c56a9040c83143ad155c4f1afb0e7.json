{"ast":null,"code":"var _jsxFileName = \"/home/phong/rails/imp/app/javascript/staff/components/report/index.js\";\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction _iterableToArrayLimit(arr, i) { if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return; var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nimport React, { useState, useEffect, useCallback } from 'react';\nimport CKEditor from '@ckeditor/ckeditor5-react';\nimport { Input, Button, Modal, ModalHeader, ModalBody, ModalFooter, Label } from 'reactstrap';\nimport '../../../commons/components/report/build/ckeditor';\nimport { getReport, postReport, updateReport, postFile } from '../../actions/report';\nimport _ from 'lodash';\nimport { useDispatch } from 'react-redux';\nimport Select from 'react-select';\nimport FormData from 'form-data';\nimport * as Yup from 'yup';\nimport { Formik } from 'formik';\nimport { styles } from './styles';\nimport { editorConfig } from './config';\nimport Images from './Images';\nvar formData = new FormData();\n\nvar filterMention = function filterMention(report_message, users, convertIdToName) {\n  _.map(users, function (user) {\n    return report_message = _.replace(report_message, new RegExp(convertIdToName ? '@' + user.user_id : '@' + user.user_name, 'g'), convertIdToName ? '@' + user.user_name : '@' + user.user_id);\n  });\n\n  return report_message;\n};\n\nvar validationSchema = Yup.object({\n  send_to: Yup.array().required('Sent to is a required field'),\n  report_message: Yup.string().required('Report message is a required field')\n});\nexport default function (props) {\n  var _this = this;\n\n  var _useState = useState({\n    send_to: [],\n    report_message: ''\n  }),\n      _useState2 = _slicedToArray(_useState, 2),\n      initialValues = _useState2[0],\n      setInitialValues = _useState2[1];\n\n  var _useState3 = useState(true),\n      _useState4 = _slicedToArray(_useState3, 2),\n      modal = _useState4[0],\n      setModal = _useState4[1];\n\n  var item = props.item,\n      reload = props.reload,\n      setSelectedItem = props.setSelectedItem;\n  var dispatch = useDispatch();\n\n  var toggle = function toggle() {\n    setModal(!modal);\n    setSelectedItem(null);\n  };\n\n  useEffect(function () {\n    getReport(item.report_id, setInitialValues);\n  }, []);\n  var handleSubmit = useCallback(function (values) {\n    var _data;\n\n    var send_to_channels = _.map(values.send_to, function (o) {\n      return {\n        channel_code: o.value,\n        channel_name: o.label\n      };\n    }); //filter send_to user to submit\n\n\n    var report_message = filterMention(values.report_message, values.users, false);\n    var ins = document.getElementById('uploadFile').files.length;\n\n    for (var x = 0; x < ins; x++) {\n      formData.append('attachments[]', document.getElementById('uploadFile').files[x]);\n    }\n\n    var data = (_data = {\n      report_message: report_message\n    }, _defineProperty(_data, \"report_message\", report_message), _defineProperty(_data, \"report_message\", report_message), _defineProperty(_data, \"send_to\", send_to_channels), _data); //create a new report need reload to update id\n\n    _.isEqual(item.report_id, null) ? dispatch(postReport(item.id, formData, reload, data)) : dispatch(updateReport(item.report_id, formData, data));\n    toggle();\n  });\n  return /*#__PURE__*/React.createElement(React.Fragment, null, initialValues.attachments !== undefined && /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Modal, {\n    size: \"lg\",\n    isOpen: modal,\n    toggle: toggle,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 6\n    }\n  }, /*#__PURE__*/React.createElement(Formik, {\n    initialValues: initialValues,\n    validationSchema: validationSchema,\n    onSubmit: handleSubmit,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 7\n    }\n  }, function (props) {\n    return /*#__PURE__*/React.createElement(\"form\", {\n      onSubmit: props.handleSubmit,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 116,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(ModalHeader, {\n      toggle: toggle,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 117,\n        columnNumber: 10\n      }\n    }, \"Daily Report!\"), /*#__PURE__*/React.createElement(ModalBody, {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 118,\n        columnNumber: 10\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(Label, {\n      style: styles.label,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 120,\n        columnNumber: 12\n      }\n    }, \"Send to:\"), /*#__PURE__*/React.createElement(Select, {\n      name: \"send_to\",\n      isMulti: true,\n      defaultValue: props.values.send_to,\n      options: props.values.channels,\n      onChange: function onChange(e) {\n        return props.setFieldValue('send_to', e);\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 121,\n        columnNumber: 12\n      }\n    }), props.errors.send_to && /*#__PURE__*/React.createElement(\"div\", {\n      style: {\n        display: 'block'\n      },\n      className: \"invalid-feedback\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 129,\n        columnNumber: 13\n      }\n    }, props.errors.send_to), /*#__PURE__*/React.createElement(Label, {\n      style: styles.label,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 135,\n        columnNumber: 12\n      }\n    }, \"Report\"), /*#__PURE__*/React.createElement(CKEditor, {\n      editor: ClassicEditor,\n      config: editorConfig(props.values.users),\n      values: filterMention(props.values.report_message, props.values.users, true),\n      data: filterMention(props.values.report_message, props.values.users, true),\n      onChange: function onChange(event, editor) {\n        props.setFieldValue('report_message', editor.getData());\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 136,\n        columnNumber: 12\n      }\n    }), props.errors.report_message && /*#__PURE__*/React.createElement(\"div\", {\n      style: {\n        display: 'block'\n      },\n      className: \"invalid-feedback\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 157,\n        columnNumber: 13\n      }\n    }, props.errors.report_message), !_.isEqual(props.values.attachments, []) && /*#__PURE__*/React.createElement(Images, {\n      images: props.values.attachments,\n      formData: formData,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 164,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      style: {\n        marginTop: '10px'\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 169,\n        columnNumber: 12\n      }\n    }, /*#__PURE__*/React.createElement(Input, {\n      id: \"uploadFile\",\n      type: \"file\",\n      multiple: true,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 170,\n        columnNumber: 13\n      }\n    })))), /*#__PURE__*/React.createElement(ModalFooter, {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 174,\n        columnNumber: 10\n      }\n    }, /*#__PURE__*/React.createElement(Button, {\n      color: \"primary\",\n      type: \"submit\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 175,\n        columnNumber: 11\n      }\n    }, \"Submit\"), ' ', /*#__PURE__*/React.createElement(Button, {\n      color: \"secondary\",\n      onClick: toggle,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 178,\n        columnNumber: 11\n      }\n    }, \"Cancel\")));\n  }))));\n}","map":{"version":3,"sources":["/home/phong/rails/imp/app/javascript/staff/components/report/index.js"],"names":["React","useState","useEffect","useCallback","CKEditor","Input","Button","Modal","ModalHeader","ModalBody","ModalFooter","Label","getReport","postReport","updateReport","postFile","_","useDispatch","Select","FormData","Yup","Formik","styles","editorConfig","Images","formData","filterMention","report_message","users","convertIdToName","map","user","replace","RegExp","user_id","user_name","validationSchema","object","send_to","array","required","string","props","initialValues","setInitialValues","modal","setModal","item","reload","setSelectedItem","dispatch","toggle","report_id","handleSubmit","values","send_to_channels","o","channel_code","value","channel_name","label","ins","document","getElementById","files","length","x","append","data","isEqual","id","attachments","undefined","channels","e","setFieldValue","errors","display","ClassicEditor","event","editor","getData","marginTop"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\nimport CKEditor from '@ckeditor/ckeditor5-react';\nimport {\n\tInput,\n\tButton,\n\tModal,\n\tModalHeader,\n\tModalBody,\n\tModalFooter,\n\tLabel,\n} from 'reactstrap';\nimport '../../../commons/components/report/build/ckeditor';\nimport {\n\tgetReport,\n\tpostReport,\n\tupdateReport,\n\tpostFile,\n} from '../../actions/report';\nimport _ from 'lodash';\nimport { useDispatch } from 'react-redux';\nimport Select from 'react-select';\nimport FormData from 'form-data';\nimport * as Yup from 'yup';\nimport { Formik } from 'formik';\n\nimport { styles } from './styles';\nimport { editorConfig } from './config';\nimport Images from './Images';\n\nlet formData = new FormData();\n\nconst filterMention = (report_message, users, convertIdToName) => {\n\t_.map(\n\t\tusers,\n\t\t(user) =>\n\t\t\t(report_message = _.replace(\n\t\t\t\treport_message,\n\t\t\t\tnew RegExp(\n\t\t\t\t\tconvertIdToName ? '@' + user.user_id : '@' + user.user_name,\n\t\t\t\t\t'g',\n\t\t\t\t),\n\t\t\t\tconvertIdToName ? '@' + user.user_name : '@' + user.user_id,\n\t\t\t)),\n\t);\n\treturn report_message;\n};\n\nconst validationSchema = Yup.object({\n\tsend_to: Yup.array().required('Sent to is a required field'),\n\treport_message: Yup.string().required('Report message is a required field'),\n});\n\nexport default function (props) {\n\tconst [initialValues, setInitialValues] = useState({\n\t\tsend_to: [],\n\t\treport_message: '',\n\t});\n\tconst [modal, setModal] = useState(true);\n\tconst { item, reload, setSelectedItem } = props;\n\tconst dispatch = useDispatch();\n\n\tconst toggle = () => {\n\t\tsetModal(!modal);\n\t\tsetSelectedItem(null);\n\t};\n\n\tuseEffect(() => {\n\t\tgetReport(item.report_id, setInitialValues);\n\t}, []);\n\n\tconst handleSubmit = useCallback((values) => {\n\t\tconst send_to_channels = _.map(values.send_to, (o) => ({\n\t\t\tchannel_code: o.value,\n\t\t\tchannel_name: o.label,\n\t\t}));\n\n\t\t//filter send_to user to submit\n\t\tconst report_message = filterMention(\n\t\t\tvalues.report_message,\n\t\t\tvalues.users,\n\t\t\tfalse,\n\t\t);\n\n\t\tlet ins = document.getElementById('uploadFile').files.length;\n\t\tfor (var x = 0; x < ins; x++) {\n\t\t\tformData.append(\n\t\t\t\t'attachments[]',\n\t\t\t\tdocument.getElementById('uploadFile').files[x],\n\t\t\t);\n\t\t}\n\n\t\tconst data = {\n\t\t\treport_message,\n\t\t\treport_message,\n\t\t\treport_message,\n\t\t\tsend_to: send_to_channels,\n\t\t};\n\n\t\t//create a new report need reload to update id\n\t\t_.isEqual(item.report_id, null)\n\t\t\t? dispatch(postReport(item.id, formData, reload, data))\n\t\t\t: dispatch(updateReport(item.report_id, formData, data));\n\t\ttoggle();\n\t});\n\n\treturn (\n\t\t<>\n\t\t\t{initialValues.attachments !== undefined && (\n\t\t\t\t<div>\n\t\t\t\t\t<Modal size='lg' isOpen={modal} toggle={toggle}>\n\t\t\t\t\t\t<Formik\n\t\t\t\t\t\t\tinitialValues={initialValues}\n\t\t\t\t\t\t\tvalidationSchema={validationSchema}\n\t\t\t\t\t\t\tonSubmit={handleSubmit}>\n\t\t\t\t\t\t\t{(props) => (\n\t\t\t\t\t\t\t\t<form onSubmit={props.handleSubmit}>\n\t\t\t\t\t\t\t\t\t<ModalHeader toggle={toggle}>Daily Report!</ModalHeader>\n\t\t\t\t\t\t\t\t\t<ModalBody>\n\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t<Label style={styles.label}>Send to:</Label>\n\t\t\t\t\t\t\t\t\t\t\t<Select\n\t\t\t\t\t\t\t\t\t\t\t\tname='send_to'\n\t\t\t\t\t\t\t\t\t\t\t\tisMulti\n\t\t\t\t\t\t\t\t\t\t\t\tdefaultValue={props.values.send_to}\n\t\t\t\t\t\t\t\t\t\t\t\toptions={props.values.channels}\n\t\t\t\t\t\t\t\t\t\t\t\tonChange={(e) => props.setFieldValue('send_to', e)}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t{props.errors.send_to && (\n\t\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\t\tstyle={{ display: 'block' }}\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName='invalid-feedback'>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{props.errors.send_to}\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t<Label style={styles.label}>Report</Label>\n\t\t\t\t\t\t\t\t\t\t\t<CKEditor\n\t\t\t\t\t\t\t\t\t\t\t\teditor={ClassicEditor}\n\t\t\t\t\t\t\t\t\t\t\t\tconfig={editorConfig(props.values.users)}\n\t\t\t\t\t\t\t\t\t\t\t\tvalues={filterMention(\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops.values.report_message,\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops.values.users,\n\t\t\t\t\t\t\t\t\t\t\t\t\ttrue,\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\tdata={filterMention(\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops.values.report_message,\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops.values.users,\n\t\t\t\t\t\t\t\t\t\t\t\t\ttrue,\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\tonChange={(event, editor) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops.setFieldValue(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'report_message',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\teditor.getData(),\n\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t{props.errors.report_message && (\n\t\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\t\tstyle={{ display: 'block' }}\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName='invalid-feedback'>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{props.errors.report_message}\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t{!_.isEqual(props.values.attachments, []) && (\n\t\t\t\t\t\t\t\t\t\t\t\t<Images\n\t\t\t\t\t\t\t\t\t\t\t\t\timages={props.values.attachments}\n\t\t\t\t\t\t\t\t\t\t\t\t\tformData={formData}\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t<div style={{ marginTop: '10px' }}>\n\t\t\t\t\t\t\t\t\t\t\t\t<Input id='uploadFile' type='file' multiple />\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</ModalBody>\n\t\t\t\t\t\t\t\t\t<ModalFooter>\n\t\t\t\t\t\t\t\t\t\t<Button color='primary' type='submit'>\n\t\t\t\t\t\t\t\t\t\t\tSubmit\n\t\t\t\t\t\t\t\t\t\t</Button>{' '}\n\t\t\t\t\t\t\t\t\t\t<Button color='secondary' onClick={toggle}>\n\t\t\t\t\t\t\t\t\t\t\tCancel\n\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t</ModalFooter>\n\t\t\t\t\t\t\t\t</form>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</Formik>\n\t\t\t\t\t</Modal>\n\t\t\t\t</div>\n\t\t\t)}\n\t\t</>\n\t);\n}\n"]},"metadata":{},"sourceType":"module"}