{"ast":null,"code":"var _jsxFileName = \"/home/phong/rails/imp/app/javascript/staff/components/report/index.js\";\n\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction _iterableToArrayLimit(arr, i) { if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return; var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nimport React, { useState, useEffect, useCallback } from 'react';\nimport CKEditor from '@ckeditor/ckeditor5-react';\nimport { Input, Button, Modal, ModalHeader, ModalBody, ModalFooter, Label } from 'reactstrap';\nimport '../../../commons/components/report/build/ckeditor';\nimport { getReport, postReport, updateReport, postFile } from '../../actions/report';\nimport _ from 'lodash';\nimport { useDispatch } from 'react-redux';\nimport Select from 'react-select';\nimport FormData from 'form-data';\nimport * as Yup from 'yup';\nimport { Formik } from 'formik';\nimport { styles } from './styles';\nimport { editorConfig } from './config';\nimport Images from './Images';\nvar formData = new FormData();\n\nvar filterMention = function filterMention(report_message, users, convertIdToName) {\n  _.map(users, function (user) {\n    return report_message = _.replace(report_message, new RegExp(convertIdToName ? '@' + user.user_id : '@' + user.user_name, 'g'), convertIdToName ? '@' + user.user_name : '@' + user.user_id);\n  });\n\n  return report_message;\n};\n\nvar validationSchema = Yup.object({\n  send_to: Yup.array().required('Sent to is a required field'),\n  report_message: Yup.string().required('Report message is a required field')\n});\nexport default function (props) {\n  var _this = this;\n\n  var _useState = useState({\n    send_to: [],\n    report_message: ''\n  }),\n      _useState2 = _slicedToArray(_useState, 2),\n      initialValues = _useState2[0],\n      setInitialValues = _useState2[1];\n\n  var _useState3 = useState(true),\n      _useState4 = _slicedToArray(_useState3, 2),\n      modal = _useState4[0],\n      setModal = _useState4[1];\n\n  var item = props.item,\n      reload = props.reload,\n      setSelectedItem = props.setSelectedItem;\n  var dispatch = useDispatch();\n\n  var toggle = function toggle() {\n    setModal(!modal);\n    setSelectedItem(null);\n  };\n\n  useEffect(function () {\n    getReport(item.report_id, setInitialValues);\n  }, []);\n  var handleSubmit = useCallback(function (values) {\n    var send_to_channels = _.map(values.send_to, function (o) {\n      return {\n        channel_code: o.value,\n        channel_name: o.label\n      };\n    }); //filter send_to user to submit\n\n\n    var report_message = filterMention(values.report_message, values.users, false);\n    var ins = document.getElementById('uploadFile').files.length;\n\n    for (var x = 0; x < ins; x++) {\n      formData.append('attachments[]', document.getElementById('uploadFile').files[x]);\n    }\n\n    var data = {\n      report_message: report_message,\n      send_to: send_to_channels\n    }; //create a new report need reload to update id\n\n    _.isEqual(item.report_id, null) ? dispatch(postReport(item.id, formData, reload, data)) : dispatch(updateReport(item.report_id, formData, data));\n    toggle();\n  });\n  return /*#__PURE__*/React.createElement(React.Fragment, null, initialValues.attachments !== undefined && /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Modal, {\n    size: \"lg\",\n    isOpen: modal,\n    toggle: toggle,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Formik, {\n    initialValues: initialValues,\n    validationSchema: validationSchema,\n    onSubmit: handleSubmit,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 13\n    }\n  }, function (props) {\n    return /*#__PURE__*/React.createElement(\"form\", {\n      onSubmit: props.handleSubmit,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 114,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(ModalHeader, {\n      toggle: toggle,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 115,\n        columnNumber: 19\n      }\n    }, \"Daily Report!\"), /*#__PURE__*/React.createElement(ModalBody, {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 116,\n        columnNumber: 19\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 117,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(Label, {\n      style: styles.label,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 118,\n        columnNumber: 23\n      }\n    }, \"Send to:\"), /*#__PURE__*/React.createElement(Select, {\n      name: \"send_to\",\n      isMulti: true,\n      defaultValue: props.values.send_to,\n      options: props.values.channels,\n      onChange: function onChange(e) {\n        return props.setFieldValue('send_to', e);\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 23\n      }\n    }), props.errors.send_to && /*#__PURE__*/React.createElement(\"div\", {\n      style: {\n        display: 'block'\n      },\n      className: \"invalid-feedback\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 127,\n        columnNumber: 25\n      }\n    }, props.errors.send_to), /*#__PURE__*/React.createElement(Label, {\n      style: styles.label,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 133,\n        columnNumber: 23\n      }\n    }, \"Report\"), /*#__PURE__*/React.createElement(CKEditor, {\n      editor: ClassicEditor,\n      config: editorConfig(props.values.users),\n      values: filterMention(props.values.report_message, props.values.users, true),\n      data: filterMention(props.values.report_message, props.values.users, true),\n      onChange: function onChange(event, editor) {\n        props.setFieldValue('report_message', editor.getData());\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 23\n      }\n    }), props.errors.report_message && /*#__PURE__*/React.createElement(\"div\", {\n      style: {\n        display: 'block'\n      },\n      className: \"invalid-feedback\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 155,\n        columnNumber: 25\n      }\n    }, props.errors.report_message), !_.isEqual(props.values.attachments, []) && /*#__PURE__*/React.createElement(Images, {\n      images: props.values.attachments,\n      formData: formData,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 162,\n        columnNumber: 25\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      style: {\n        marginTop: '10px'\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 167,\n        columnNumber: 23\n      }\n    }, /*#__PURE__*/React.createElement(Input, {\n      id: \"uploadFile\",\n      type: \"file\",\n      multiple: true,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 168,\n        columnNumber: 25\n      }\n    })))), /*#__PURE__*/React.createElement(ModalFooter, {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 172,\n        columnNumber: 19\n      }\n    }, /*#__PURE__*/React.createElement(Button, {\n      color: \"primary\",\n      type: \"submit\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 173,\n        columnNumber: 21\n      }\n    }, \"Submit\"), ' ', /*#__PURE__*/React.createElement(Button, {\n      color: \"secondary\",\n      onClick: toggle,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 176,\n        columnNumber: 21\n      }\n    }, \"Cancel\")));\n  }))));\n}","map":{"version":3,"sources":["/home/phong/rails/imp/app/javascript/staff/components/report/index.js"],"names":["React","useState","useEffect","useCallback","CKEditor","Input","Button","Modal","ModalHeader","ModalBody","ModalFooter","Label","getReport","postReport","updateReport","postFile","_","useDispatch","Select","FormData","Yup","Formik","styles","editorConfig","Images","formData","filterMention","report_message","users","convertIdToName","map","user","replace","RegExp","user_id","user_name","validationSchema","object","send_to","array","required","string","props","initialValues","setInitialValues","modal","setModal","item","reload","setSelectedItem","dispatch","toggle","report_id","handleSubmit","values","send_to_channels","o","channel_code","value","channel_name","label","ins","document","getElementById","files","length","x","append","data","isEqual","id","attachments","undefined","channels","e","setFieldValue","errors","display","ClassicEditor","event","editor","getData","marginTop"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\nimport CKEditor from '@ckeditor/ckeditor5-react';\nimport {\n  Input,\n  Button,\n  Modal,\n  ModalHeader,\n  ModalBody,\n  ModalFooter,\n  Label,\n} from 'reactstrap';\nimport '../../../commons/components/report/build/ckeditor';\nimport {\n  getReport,\n  postReport,\n  updateReport,\n  postFile,\n} from '../../actions/report';\nimport _ from 'lodash';\nimport { useDispatch } from 'react-redux';\nimport Select from 'react-select';\nimport FormData from 'form-data';\nimport * as Yup from 'yup';\nimport { Formik } from 'formik';\n\nimport { styles } from './styles';\nimport { editorConfig } from './config';\nimport Images from './Images';\n\nlet formData = new FormData();\n\nconst filterMention = (report_message, users, convertIdToName) => {\n  _.map(\n    users,\n    (user) =>\n      (report_message = _.replace(\n        report_message,\n        new RegExp(\n          convertIdToName ? '@' + user.user_id : '@' + user.user_name,\n          'g',\n        ),\n        convertIdToName ? '@' + user.user_name : '@' + user.user_id,\n      )),\n  );\n  return report_message;\n};\n\nconst validationSchema = Yup.object({\n  send_to: Yup.array().required('Sent to is a required field'),\n  report_message: Yup.string().required('Report message is a required field'),\n});\n\nexport default function (props) {\n  const [initialValues, setInitialValues] = useState({\n    send_to: [],\n    report_message: '',\n  });\n  const [modal, setModal] = useState(true);\n  const { item, reload, setSelectedItem } = props;\n  const dispatch = useDispatch();\n\n  const toggle = () => {\n    setModal(!modal);\n    setSelectedItem(null);\n  };\n\n  useEffect(() => {\n    getReport(item.report_id, setInitialValues);\n  }, []);\n\n  const handleSubmit = useCallback((values) => {\n    const send_to_channels = _.map(values.send_to, (o) => ({\n      channel_code: o.value,\n      channel_name: o.label,\n    }));\n\n    //filter send_to user to submit\n    const report_message = filterMention(\n      values.report_message,\n      values.users,\n      false,\n    );\n\n    let ins = document.getElementById('uploadFile').files.length;\n    for (var x = 0; x < ins; x++) {\n      formData.append(\n        'attachments[]',\n        document.getElementById('uploadFile').files[x],\n      );\n    }\n\n    const data = {\n      report_message,\n      send_to: send_to_channels,\n    };\n\n    //create a new report need reload to update id\n    _.isEqual(item.report_id, null)\n      ? dispatch(postReport(item.id, formData, reload, data))\n      : dispatch(updateReport(item.report_id, formData, data));\n    toggle();\n  });\n\n  return (\n    <>\n      {initialValues.attachments !== undefined && (\n        <div>\n          <Modal size='lg' isOpen={modal} toggle={toggle}>\n            <Formik\n              initialValues={initialValues}\n              validationSchema={validationSchema}\n              onSubmit={handleSubmit}>\n              {(props) => (\n                <form onSubmit={props.handleSubmit}>\n                  <ModalHeader toggle={toggle}>Daily Report!</ModalHeader>\n                  <ModalBody>\n                    <div>\n                      <Label style={styles.label}>Send to:</Label>\n                      <Select\n                        name='send_to'\n                        isMulti\n                        defaultValue={props.values.send_to}\n                        options={props.values.channels}\n                        onChange={(e) => props.setFieldValue('send_to', e)}\n                      />\n                      {props.errors.send_to && (\n                        <div\n                          style={{ display: 'block' }}\n                          className='invalid-feedback'>\n                          {props.errors.send_to}\n                        </div>\n                      )}\n                      <Label style={styles.label}>Report</Label>\n                      <CKEditor\n                        editor={ClassicEditor}\n                        config={editorConfig(props.values.users)}\n                        values={filterMention(\n                          props.values.report_message,\n                          props.values.users,\n                          true,\n                        )}\n                        data={filterMention(\n                          props.values.report_message,\n                          props.values.users,\n                          true,\n                        )}\n                        onChange={(event, editor) => {\n                          props.setFieldValue(\n                            'report_message',\n                            editor.getData(),\n                          );\n                        }}\n                      />\n                      {props.errors.report_message && (\n                        <div\n                          style={{ display: 'block' }}\n                          className='invalid-feedback'>\n                          {props.errors.report_message}\n                        </div>\n                      )}\n                      {!_.isEqual(props.values.attachments, []) && (\n                        <Images\n                          images={props.values.attachments}\n                          formData={formData}\n                        />\n                      )}\n                      <div style={{ marginTop: '10px' }}>\n                        <Input id='uploadFile' type='file' multiple />\n                      </div>\n                    </div>\n                  </ModalBody>\n                  <ModalFooter>\n                    <Button color='primary' type='submit'>\n                      Submit\n                    </Button>{' '}\n                    <Button color='secondary' onClick={toggle}>\n                      Cancel\n                    </Button>\n                  </ModalFooter>\n                </form>\n              )}\n            </Formik>\n          </Modal>\n        </div>\n      )}\n    </>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}